__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.InAppWebConnector=void 0;var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3]),l=r(d[4]),c=r(d[5]),h=r(d[6]),u=r(d[7]),w=r(d[8]),y=r(d[9]),p=r(d[10]),k=r(d[11]),f=r(d[12]),b=r(d[13]),v=r(d[14]),W=r(d[15]),S=r(d[16]),A=r(d[17]);function I(t,s){throw new Error(s??`Invalid param: ${t}`)}function T(){return"undefined"!=typeof window&&window.localStorage?n.webLocalStorage:s.inMemoryStorage}e.InAppWebConnector=class{isClientIdLegacyPaper(t){return t.indexOf("-")>0&&36===t.length}constructor({client:s,onAuthSuccess:n,ecosystem:o,passkeyDomain:l,storage:c}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(s.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const u=(0,t.getThirdwebBaseUrl)("inAppWallet");this.client=s,this.ecosystem=o,this.passkeyDomain=l,this.storage=new h.ClientScopedStorage({clientId:s.clientId,ecosystem:o,storage:c??T()}),this.querier=new b.InAppWalletIframeCommunicator({baseUrl:u,clientId:s.clientId,ecosystem:o}),this.auth=new v.Auth({baseUrl:u,client:s,ecosystem:o,localStorage:this.storage,onAuthSuccess:async t=>{if(n?.(t),"sharded"===t.storedToken.authDetails.walletType){await this.querier.call({params:{storedToken:t.storedToken},procedureName:"migrateFromShardToEnclave"})||console.warn("Failed to migrate from sharded to enclave wallet, continuing with sharded wallet")}if(this.wallet=await this.initializeWallet(t.storedToken.cookieString),!this.wallet)throw new Error("Failed to initialize wallet");const s="deviceShareStored"in t.walletDetails?t.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({deviceShareStored:s,storedToken:t.storedToken}),this.wallet instanceof A.IFrameWallet&&await this.querier.call({params:{authCookie:t.storedToken.cookieString,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in t.walletDetails?t.walletDetails.deviceShareStored:null,ecosystemId:o?.id,partnerId:o?.partnerId,walletUserId:t.storedToken.authDetails.userWalletId},procedureName:"initIframe"}),{user:{account:await this.wallet.getAccount(),authDetails:t.storedToken.authDetails,status:"Logged In, Wallet Initialized",walletAddress:t.walletDetails.walletAddress}}},querier:this.querier})}async initializeWallet(t){const s=await this.storage.getAuthCookie();if(!t&&null===s)throw new Error("No auth token provided and no stored auth token found to initialize the wallet");const n=await(0,o.getUserStatus)({authToken:t||s,client:this.client,ecosystem:this.ecosystem});if(!n)throw new Error("Cannot initialize wallet, no user logged in");if(0===n.wallets.length)throw new Error("Cannot initialize wallet, this user does not have a wallet generated yet");return"enclave"===n.wallets[0]?.type?new f.EnclaveWallet({address:n.wallets[0].address,client:this.client,ecosystem:this.ecosystem,storage:this.storage}):new A.IFrameWallet({client:this.client,ecosystem:this.ecosystem,localStorage:this.storage,querier:this.querier})}async getUser(){if(!this.wallet){const t=await this.storage.getAuthCookie();if(!t)return{status:"Logged Out"};this.wallet=await this.initializeWallet(t)}if(!this.wallet)throw new Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw new Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(t){return(0,S.sendOtp)({...t,client:this.client,ecosystem:this.ecosystem})}async authenticateWithRedirect(t,s,n){return(0,W.loginWithOauthRedirect)({authOption:t,client:this.client,ecosystem:this.ecosystem,mode:s,redirectUrl:n})}async loginWithAuthToken(t,s){return this.auth.loginWithAuthToken(t,s)}async authenticate(t){const s=t.strategy;switch(s){case"email":case"phone":return(0,S.verifyOtp)({...t,client:this.client,ecosystem:this.ecosystem});case"auth_endpoint":return(0,l.authEndpoint)({client:this.client,ecosystem:this.ecosystem,payload:t.payload});case"jwt":return(0,w.customJwt)({client:this.client,ecosystem:this.ecosystem,jwt:t.jwt});case"passkey":return this.passkeyAuth(t);case"iframe_email_verification":return this.auth.authenticateWithIframe({email:t.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"github":case"twitch":case"farcaster":case"line":case"x":case"tiktok":case"steam":case"coinbase":case"discord":return(0,W.loginWithOauth)({authOption:s,client:this.client,closeOpenedWindow:t.closeOpenedWindow,ecosystem:this.ecosystem,openedWindow:t.openedWindow});case"guest":return(0,u.guestAuthenticate)({client:this.client,ecosystem:this.ecosystem,storage:this.storage});case"backend":return(0,c.backendAuthenticate)({client:this.client,ecosystem:this.ecosystem,walletSecret:t.walletSecret});case"wallet":return(0,k.siweAuthenticate)({chain:t.chain,client:this.client,ecosystem:this.ecosystem,wallet:t.wallet})}}async connect(t){const s=t.strategy;switch(s){case"auth_endpoint":case"jwt":{const s=await this.authenticate(t);return await this.loginWithAuthToken(s,t.encryptionKey)}case"iframe_email_verification":return this.auth.loginWithIframe({email:t.email});case"iframe":return this.auth.loginWithModal();case"passkey":{const s=await this.passkeyAuth(t);return this.loginWithAuthToken(s)}case"backend":case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"github":case"line":case"x":case"tiktok":case"guest":case"coinbase":case"twitch":case"steam":case"discord":{const s=await this.authenticate(t);return await this.auth.loginWithAuthToken(s)}default:I(s)}}async logout(){return await this.auth.logout()}async passkeyAuth(t){const{PasskeyWebClient:s}=await r(d[19])(d[18],d.paths),{passkeyName:n,storeLastUsedPasskey:o=!0}=t,l=new s,c=this.storage;return"sign-up"===t.type?(0,p.registerPasskey)({client:this.client,ecosystem:this.ecosystem,passkeyClient:l,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:o?c:void 0,username:n}):(0,p.loginWithPasskey)({client:this.client,ecosystem:this.ecosystem,passkeyClient:l,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:o?c:void 0})}async linkProfile(t){const{storedToken:s}=await this.authenticate(t);return await(0,y.linkAccount)({client:t.client,ecosystem:t.ecosystem||this.ecosystem,storage:this.storage,tokenToLink:s.cookieString})}async unlinkProfile(t,s){return await(0,y.unlinkAccount)({allowAccountDeletion:s,client:this.client,ecosystem:this.ecosystem,profileToUnlink:t,storage:this.storage})}async getProfiles(){return(0,y.getLinkedProfilesInternal)({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}}),4140,{"0":1128,"1":4141,"2":4046,"3":4142,"4":4143,"5":4146,"6":4148,"7":4150,"8":4151,"9":4152,"10":4153,"11":4154,"12":4155,"13":4160,"14":4162,"15":4166,"16":4168,"17":4169,"18":4170,"19":1353,"paths":{}});
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.getUserStatus=async function({authToken:o,client:c,ecosystem:s}){const l=(0,n.getClientFetch)(c,s),u=await l(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/accounts`,{headers:{Authorization:`Bearer embedded-wallet-token:${o}`,"Content-Type":"application/json"},method:"GET"});if(!u.ok){const t=await u.text().catch((()=>"Unknown error"));throw new Error(`Failed to get user info: ${t}`)}return await u.json()};var t=r(d[0]),n=r(d[1])}),4142,[1128,1129]);
__d((function(g,r,i,a,m,_e,d){Object.defineProperty(_e,"__esModule",{value:!0}),_e.authEndpoint=async function(s){const c=(0,e.getClientFetch)(s.client,s.ecosystem),l=await c(o.ROUTE_AUTH_ENDPOINT_CALLBACK,{body:(0,t.stringify)({developerClientId:s.client.clientId,payload:s.payload}),headers:{"Content-Type":"application/json"},method:"POST"});if(!l.ok){const e=await l.json();throw new Error(`Custom auth endpoint authentication error: ${e.message}`)}try{const{verifiedToken:e}=await l.json();return{storedToken:e}}catch(e){throw new Error((0,n.createErrorMessage)("Malformed response from post auth_endpoint authentication",e))}};var e=r(d[0]),t=r(d[1]),o=r(d[2]),n=r(d[3])}),4143,[1129,1136,4144,4145]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.THIRDWEB_SESSION_NONCE_HEADER=e.ROUTE_VERIFY_THIRDWEB_CLIENT_ID=e.ROUTE_STORE_USER_SHARES=e.ROUTE_GET_USER_SHARES=e.ROUTE_EMBEDDED_WALLET_DETAILS=e.ROUTE_COGNITO_IDENTITY_POOL_URL=e.ROUTE_AUTH_JWT_CALLBACK=e.ROUTE_AUTH_ENDPOINT_CALLBACK=e.ROUTE_AUTH_COGNITO_ID_TOKEN_V2=e.ROUTE_AUTH_COGNITO_ID_TOKEN_V1=e.RECOVERY_SHARE_INDEX=e.INVALID_DEVICE_SHARE_MESSAGE=e.GENERATE_RECOVERY_PASSWORD_LAMBDA_FUNCTION_V2=e.GENERATE_RECOVERY_PASSWORD_LAMBDA_FUNCTION_V1=e.ENCLAVE_KMS_KEY_ARN=e.DEVICE_SHARE_MISSING_MESSAGE=e.DEVICE_SHARE_INDEX=e.COGNITO_IDENTITY_POOL_ID=e.AWS_REGION=e.AUTH_SHARE_INDEX=void 0;var E=r(d[0]);e.AUTH_SHARE_INDEX=2,e.DEVICE_SHARE_INDEX=0,e.DEVICE_SHARE_MISSING_MESSAGE="Missing device share.",e.INVALID_DEVICE_SHARE_MESSAGE="Invalid private key reconstructed from shares",e.RECOVERY_SHARE_INDEX=1;const _=e.AWS_REGION="us-west-2",T=(e.THIRDWEB_SESSION_NONCE_HEADER="x-session-nonce",e.COGNITO_IDENTITY_POOL_ID="us-west-2:2ad7ab1e-f48b-48a6-adfa-ac1090689c26",e.GENERATE_RECOVERY_PASSWORD_LAMBDA_FUNCTION_V1="arn:aws:lambda:us-west-2:324457261097:function:recovery-share-password-GenerateRecoverySharePassw-bbE5ZbVAToil",e.GENERATE_RECOVERY_PASSWORD_LAMBDA_FUNCTION_V2="arn:aws:lambda:us-west-2:324457261097:function:lambda-thirdweb-auth-enc-key-prod-ThirdwebAuthEncKeyFunction",e.ENCLAVE_KMS_KEY_ARN="arn:aws:kms:us-west-2:324457261097:key/ccfb9ecd-f45d-4f37-864a-25fe72dcb49e",`${(0,E.getThirdwebBaseUrl)("inAppWallet")}/`),R=`${T}api/2023-10-20`,O=`${T}api/2024-05-05`;e.ROUTE_EMBEDDED_WALLET_DETAILS=`${R}/embedded-wallet/embedded-wallet-user-details`,e.ROUTE_COGNITO_IDENTITY_POOL_URL=`cognito-idp.${_}.amazonaws.com/us-west-2_UFwLcZIpq`,e.ROUTE_STORE_USER_SHARES=`${R}/embedded-wallet/embedded-wallet-shares`,e.ROUTE_GET_USER_SHARES=`${R}/embedded-wallet/embedded-wallet-shares`,e.ROUTE_VERIFY_THIRDWEB_CLIENT_ID=`${R}/embedded-wallet/verify-thirdweb-client-id`,e.ROUTE_AUTH_JWT_CALLBACK=`${R}/embedded-wallet/validate-custom-jwt`,e.ROUTE_AUTH_ENDPOINT_CALLBACK=`${R}/embedded-wallet/validate-custom-auth-endpoint`,e.ROUTE_AUTH_COGNITO_ID_TOKEN_V1=`${R}/embedded-wallet/cognito-id-token`,e.ROUTE_AUTH_COGNITO_ID_TOKEN_V2=`${O}/login/web-token-exchange`}),4144,[1128]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.createErrorMessage=e.ErrorMessages=void 0;var s=r(d[0]);e.ErrorMessages={invalidOtp:"Your OTP code is invalid or expired. Please request a new code or try again.",missingRecoveryCode:"Missing encryption key for user"};e.createErrorMessage=(o,n)=>n instanceof Error?`${o}: ${n.message}`:`${o}: ${(0,s.stringify)(n)}`}),4145,[1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.backendAuthenticate=async function(o){const s=(0,t.getClientFetch)(o.client,o.ecosystem),l=(0,c.getLoginUrl)({authOption:"backend",client:o.client,ecosystem:o.ecosystem}),u=await s(`${l}`,{body:(0,n.stringify)({walletSecret:o.walletSecret}),headers:{"Content-Type":"application/json"},method:"POST"});if(!u.ok){const t=await u.text();throw new Error(`Failed to generate backend account: ${t}`)}return await u.json()};var t=r(d[0]),n=r(d[1]),c=r(d[2])}),4146,[1129,1136,4147]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.guestAuthenticate=async function(c){let u=await c.storage.getGuestSessionId();u||(u=(0,n.randomBytesHex)(32),c.storage.saveGuestSessionId(u));const l=(0,t.getClientFetch)(c.client,c.ecosystem),y=(0,o.getLoginCallbackUrl)({authOption:"guest",client:c.client,ecosystem:c.ecosystem}),h=await l(`${y}`,{body:(0,s.stringify)({sessionId:u}),headers:{"Content-Type":"application/json"},method:"POST"});if(!h.ok){const t=await h.text();throw new Error(`Failed to generate guest account: ${h.status} ${h.statusText} ${t}`)}return await h.json()};var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3])}),4150,[1129,1136,2401,4147]);
__d((function(g,r,i,a,m,_e,d){Object.defineProperty(_e,"__esModule",{value:!0}),_e.customJwt=async function(s){const c=(0,e.getClientFetch)(s.client,s.ecosystem),w=await c(o.ROUTE_AUTH_JWT_CALLBACK,{body:(0,t.stringify)({developerClientId:s.client.clientId,jwt:s.jwt}),headers:{"Content-Type":"application/json"},method:"POST"});if(!w.ok){const e=await w.json();throw new Error(`JWT authentication error: ${e.message}`)}try{const{verifiedToken:e}=await w.json();return{storedToken:e}}catch(e){throw new Error((0,n.createErrorMessage)("Malformed response from post jwt authentication",e))}};var e=r(d[0]),t=r(d[1]),o=r(d[2]),n=r(d[3])}),4151,[1129,1136,4144,4145]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.getLinkedProfilesInternal=async function({client:o,ecosystem:c,storage:s}){const l=(0,n.getClientFetch)(o,c),u=(0,t.getThirdwebBaseUrl)("inAppWallet"),w=await s.getAuthCookie();if(!w)throw new Error("Failed to get linked accounts, no user logged in");const h={Authorization:`Bearer iaw-auth-token:${w}`,"Content-Type":"application/json"},k=await l(`${u}/api/2024-05-05/accounts`,{headers:h,method:"GET"});if(!k.ok){const t=await k.json();throw new Error(t.message||"Failed to get linked accounts.")}const{linkedAccounts:p}=await k.json();return p??[]},e.linkAccount=async function({client:c,ecosystem:s,tokenToLink:l,storage:u}){const w=(0,n.getClientFetch)(c,s),h=(0,t.getThirdwebBaseUrl)("inAppWallet"),k=await u.getAuthCookie();if(!k)throw new Error("Failed to link account, no user logged in");const p={Authorization:`Bearer iaw-auth-token:${k}`,"Content-Type":"application/json"},A=await w(`${h}/api/2024-05-05/account/connect`,{body:(0,o.stringify)({accountAuthTokenToConnect:l}),headers:p,method:"POST"});if(!A.ok){const t=await A.json();throw new Error(t.message||"Failed to link account.")}const{linkedAccounts:y}=await A.json();return y??[]},e.unlinkAccount=async function({client:c,ecosystem:s,profileToUnlink:l,allowAccountDeletion:u=!1,storage:w}){const h=(0,n.getClientFetch)(c,s),k=(0,t.getThirdwebBaseUrl)("inAppWallet"),p=await w.getAuthCookie();if(!p)throw new Error("Failed to unlink account, no user logged in");const A={Authorization:`Bearer iaw-auth-token:${p}`,"Content-Type":"application/json"},y=await h(`${k}/api/2024-05-05/account/disconnect`,{body:(0,o.stringify)({allowAccountDeletion:u,details:l.details,type:l.type}),headers:A,method:"POST"});if(!y.ok){const t=await y.json();throw new Error(t.message||"Failed to unlink account.")}const{linkedAccounts:f}=await y.json();return f??[]};var t=r(d[0]),n=r(d[1]),o=r(d[2])}),4152,[1128,1129,1136]);
__d((function(g,_r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.loginWithPasskey=async function(t){if(!t.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const c=(0,r.getClientFetch)(t.client,t.ecosystem),[l,y]=await Promise.all([c(o("sign-in")).then((t=>t.json())),t.storage?.getPasskeyCredentialId()]);if(!l.challenge)throw new Error("No challenge received");const p=l.challenge,h=await t.passkeyClient.authenticate({challenge:p,credentialId:y??void 0,rp:t.rp}),w={};t.ecosystem?.partnerId&&(w["x-ecosystem-partner-id"]=t.ecosystem.partnerId);t.ecosystem?.id&&(w["x-ecosystem-id"]=t.ecosystem.id);const u=await c(s(),{body:(0,n.stringify)({authenticatorData:h.authenticatorData,clientData:h.clientData,credentialId:h.credentialId,origin:h.origin,rpId:t.rp.id,serverVerificationId:l.serverVerificationId,signature:h.signature,type:"sign-in"}),headers:{"Content-Type":"application/json",...w},method:"POST"}),I=await u.json();if(!I||!I.storedToken)throw new Error(`Error verifying passkey: ${I.message??"unknown error"}`);return await(t.storage?.savePasskeyCredentialId(h.credentialId)),I},e.registerPasskey=async function(t){if(!t.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const c=(0,r.getClientFetch)(t.client,t.ecosystem),l=t.username??(h=t.ecosystem,`${h?.id??"wallet"}-${(new Date).toISOString()}`),y=await c(o("sign-up",l)),p=await y.json();var h;if(!p.challenge)throw new Error("No challenge received");const w=p.challenge,u=await t.passkeyClient.register({challenge:w,name:l,rp:t.rp}),I={};t.ecosystem?.partnerId&&(I["x-ecosystem-partner-id"]=t.ecosystem.partnerId);t.ecosystem?.id&&(I["x-ecosystem-id"]=t.ecosystem.id);const f=await c(s(),{body:(0,n.stringify)({authenticatorData:u.authenticatorData,clientData:u.clientData,credential:{algorithm:u.credential.algorithm,publicKey:u.credential.publicKey},credentialId:u.credentialId,origin:u.origin,rpId:t.rp.id,serverVerificationId:p.serverVerificationId,type:"sign-up",username:l}),headers:{"Content-Type":"application/json",...I},method:"POST"}),k=await f.json();if(!k||!k.storedToken)throw new Error(`Error verifying passkey: ${k.message??"unknown error"}`);return await(t.storage?.savePasskeyCredentialId(u.credentialId)),k};var t=_r(d[0]),r=_r(d[1]),n=_r(d[2]);function s(){return`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function o(r,n){return`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey?type=${r}${n?`&username=${n}`:""}`}}),4153,[1128,1129,1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.siweAuthenticate=async function(s){const{wallet:l,chain:y,client:u,ecosystem:w}=s,h=l.getAccount()||await l.connect({chain:y,client:u}),p=(0,n.getClientFetch)(u,w),f=await(async()=>{const t=(0,c.getLoginUrl)({authOption:"wallet",client:s.client,ecosystem:s.ecosystem}),n=await p(`${t}&address=${h.address}&chainId=${y.id}`);if(!n.ok)throw new Error("Failed to generate SIWE login payload");return await n.json()})(),{signature:$}=await(0,t.signLoginPayload)({account:h,payload:f});return await(async()=>{const t=(0,c.getLoginCallbackUrl)({authOption:"wallet",client:s.client,ecosystem:s.ecosystem}),n=await p(`${t}&signature=${$}&payload=${encodeURIComponent(f)}`,{body:(0,o.stringify)({payload:f,signature:$}),headers:{"Content-Type":"application/json"},method:"POST"});if(!n.ok)throw new Error("Failed to verify SIWE signature");return await n.json()})()};var t=r(d[0]),n=r(d[1]),o=r(d[2]),c=r(d[3])}),4154,[3017,1129,1136,4147]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.EnclaveWallet=void 0;var t=r(d[0]),s=r(d[1]),n=r(d[2]),o=r(d[3]),c=r(d[4]),l=r(d[5]),u=r(d[6]),h=r(d[7]),y=r(d[8]),p=r(d[9]),w=r(d[10]),I=r(d[11]),P=r(d[12]);function b(t){return void 0===t||(0,u.isHex)(t)?t:(0,u.toHex)(t)}e.EnclaveWallet=class{constructor({client:t,ecosystem:s,address:n,storage:o}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=s,this.address=n,this.localStorage=o}async postWalletSetUp(t){await this.localStorage.saveAuthCookie(t.storedToken.cookieString)}async getUserWalletStatus(){const t=await this.localStorage.getAuthCookie();if(!t)return{status:"Logged Out"};const s=await(0,y.getUserStatus)({authToken:t,client:this.client,ecosystem:this.ecosystem});if(!s)return{status:"Logged Out"};const n=s.wallets[0],o={email:s.linkedAccounts.find((t=>void 0!==t.details.email))?.details.email,phoneNumber:s.linkedAccounts.find((t=>void 0!==t.details.phone))?.details.phone,recoveryShareManagement:"ENCLAVE",userWalletId:s.id||""};return n?{account:await this.getAccount(),authDetails:o,status:"Logged In, Wallet Initialized",walletAddress:n.address}:{authDetails:o,status:"Logged In, Wallet Uninitialized"}}async getAccount(){const y=this.client,v=this.localStorage,f=this.address,A=this.ecosystem,x=async t=>{const s=(0,c.getRpcClient)({chain:(0,n.getCachedChain)(t.chainId),client:y}),o={chainId:(0,u.toHex)(t.chainId),data:t.data,gas:b(t.gas),nonce:b(t.nonce)||(0,u.toHex)(await r(d[14])(d[13],d.paths).then((({eth_getTransactionCount:t})=>t(s,{address:(0,l.getAddress)(this.address),blockTag:"pending"})))),to:t.to?(0,l.getAddress)(t.to):void 0,value:b(t.value)};return t.authorizationList&&t.authorizationList.length>0?(o.type=4,o.authorizationList=t.authorizationList,o.maxFeePerGas=b(t.maxFeePerGas),o.maxPriorityFeePerGas=b(t.maxPriorityFeePerGas)):b(t.maxFeePerGas)?(o.maxFeePerGas=b(t.maxFeePerGas),o.maxPriorityFeePerGas=b(t.maxPriorityFeePerGas),o.type=2):(o.gasPrice=b(t.gasPrice),o.type=0),(0,I.signTransaction)({client:y,payload:o,storage:v})},C={address:(0,l.getAddress)(f),async sendTransaction(t){const l=(0,c.getRpcClient)({chain:(0,n.getCachedChain)(t.chainId),client:y}),u=await x(t),h=await(0,o.eth_sendRawTransaction)(l,u);return(0,s.trackTransaction)({chainId:t.chainId,client:y,contractAddress:t.to??void 0,ecosystem:A,gasPrice:t.gasPrice,transactionHash:h,walletAddress:f,walletType:"inApp"}),{transactionHash:h}},async signAuthorization(t){const s=await(0,p.signAuthorization)({client:y,payload:t,storage:v});return{address:(0,l.getAddress)(s.address),chainId:Number.parseInt(s.chainId),nonce:BigInt(s.nonce),r:BigInt(s.r),s:BigInt(s.s),yParity:Number.parseInt(s.yParity)}},async signMessage({message:s,originalMessage:n,chainId:o}){const c="string"==typeof s?{chainId:o,isRaw:!1,message:s,originalMessage:n}:{chainId:o,isRaw:!0,message:"string"==typeof s.raw?s.raw:(0,t.bytesToHex)(s.raw),originalMessage:n},{signature:l}=await(0,w.signMessage)({client:y,payload:c,storage:v});return l},async signTransaction(t){if(!t.chainId)throw new Error("chainId required in tx to sign");return x({chainId:t.chainId,...t})},async signTypedData(t){const s=(0,h.parseTypedData)(t),{signature:n}=await(0,P.signTypedData)({client:y,payload:s,storage:v});return n},sendCalls:async t=>{const{inAppWalletSendCalls:s}=await r(d[14])(d[15],d.paths),n=t.calls[0];if(!n)throw new Error("No calls to send");const o=n.client;return{chain:n.chain||t.chain,client:o,id:await s({account:C,calls:t.calls})}},getCallsStatus:async t=>{const{inAppWalletGetCallsStatus:s}=await r(d[14])(d[15],d.paths);return s(t)},getCapabilities:async t=>({[t.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:!1}}})};return C}}}),4155,{"0":1254,"1":1679,"2":1127,"3":2457,"4":1668,"5":1210,"6":1231,"7":4054,"8":4142,"9":4156,"10":4157,"11":4158,"12":4159,"13":2727,"14":1353,"15":4138,"paths":{"4138":"/_expo/static/js/web/in-app-wallet-calls-06522646e1d6ea3a37a36b90cc319b35.js"}});
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.signAuthorization=async function({client:s,payload:c,storage:l}){const h=await l.getAuthCookie(),u=l.ecosystem,w=(0,n.getClientFetch)(s,u);if(!h)throw new Error("No auth token found when signing message");const p={address:c.address,chainId:c.chainId,nonce:Number(c.nonce)},f=await w(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-authorization`,{body:(0,o.stringify)(p),headers:{Authorization:`Bearer embedded-wallet-token:${h}`,"Content-Type":"application/json","x-thirdweb-client-id":s.clientId},method:"POST"});if(!f.ok)throw new Error(`Failed to sign message - ${f.status} ${f.statusText}`);return await f.json()};var t=r(d[0]),n=r(d[1]),o=r(d[2])}),4156,[1128,1129,1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.signMessage=async function({client:o,payload:{message:l,isRaw:c,originalMessage:w,chainId:h},storage:u}){const p=await u.getAuthCookie(),y=u.ecosystem,f=(0,s.getClientFetch)(o,y);if(!p)throw new Error("No auth token found when signing message");const b=await f(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-message`,{body:(0,n.stringify)({messagePayload:{chainId:h,isRaw:c,message:l,originalMessage:w}}),headers:{Authorization:`Bearer embedded-wallet-token:${p}`,"Content-Type":"application/json","x-thirdweb-client-id":o.clientId},method:"POST"});if(!b.ok)throw new Error(`Failed to sign message - ${b.status} ${b.statusText}`);return await b.json()};var t=r(d[0]),s=r(d[1]),n=r(d[2])}),4157,[1128,1129,1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.signTransaction=async function({client:s,payload:c,storage:l}){const u=await l.getAuthCookie(),w=l.ecosystem,h=(0,n.getClientFetch)(s,w);if(!u)throw new Error("No auth token found when signing transaction");const p=await h(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-transaction`,{body:(0,o.stringify)({transactionPayload:c}),headers:{Authorization:`Bearer embedded-wallet-token:${u}`,"Content-Type":"application/json","x-thirdweb-client-id":s.clientId},method:"POST"});if(!p.ok)throw new Error(`Failed to sign transaction - ${p.status} ${p.statusText}`);return(await p.json()).signature};var t=r(d[0]),n=r(d[1]),o=r(d[2])}),4158,[1128,1129,1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.signTypedData=async function({client:s,payload:l,storage:c}){const p=await c.getAuthCookie(),w=c.ecosystem,h=(0,n.getClientFetch)(s,w);if(!p)throw new Error("No auth token found when signing typed data");const u=await h(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-typed-data`,{body:(0,o.stringify)({...l}),headers:{Authorization:`Bearer embedded-wallet-token:${p}`,"Content-Type":"application/json","x-thirdweb-client-id":s.clientId},method:"POST"});if(!u.ok)throw new Error(`Failed to sign typed data - ${u.status} ${u.statusText}`);return await u.json()};var t=r(d[0]),n=r(d[1]),o=r(d[2])}),4159,[1128,1129,1136]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.InAppWalletIframeCommunicator=void 0;var t=r(d[0]),s=r(d[1]),o=r(d[2]),n=r(d[3]);class c extends n.IframeCommunicator{constructor({clientId:n,baseUrl:c,ecosystem:p}){super({baseUrl:c,clientId:n,container:"undefined"==typeof document?void 0:document.body,ecosystem:p,iframeId:I+(p?.id||""),link:l({baseUrl:c,clientId:n,ecosystem:p,path:o.IN_APP_WALLET_PATH}).href,localStorage:new s.ClientScopedStorage({clientId:n,ecosystem:p,storage:t.webLocalStorage})}),this.clientId=n,this.ecosystem=p}}function l({clientId:t,baseUrl:s,path:o,ecosystem:n,queryParams:c}){const l=new URL(`${o}`,s);if(c)for(const t of Object.keys(c))l.searchParams.set(t,c[t]?.toString()||"");return l.searchParams.set("clientId",t),void 0!==n?.partnerId&&l.searchParams.set("partnerId",n.partnerId),void 0!==n?.id&&l.searchParams.set("ecosystemId",n.id),l}e.InAppWalletIframeCommunicator=c;const I="thirdweb-in-app-wallet-iframe"}),4160,[4046,4148,4149,4161]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.IframeCommunicator=void 0;var t=r(d[0]);const o={backgroundColor:"transparent",border:"none",colorScheme:"light",display:"none",height:"100%",pointerEvents:"all",position:"fixed",right:"0px",top:"0px",width:"100%",zIndex:"2147483646"},s=new Map;e.IframeCommunicator=class{constructor({link:t,baseUrl:s,iframeId:n,container:l,onIframeInitialize:c,localStorage:f,clientId:h,ecosystem:u}){if(Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=f,this.clientId=h,this.ecosystem=u,this.iframeBaseUrl=s,"undefined"==typeof document)return;l=l??document.body;let b=document.getElementById(n);const p=new URL(t);if(!b||b.src!==p.href){b=document.createElement("iframe");const t={...o};Object.assign(b.style,t),b.setAttribute("id",n),b.setAttribute("fetchpriority","high"),l.appendChild(b),b.src=p.href;const s=t=>{if("ewsIframeLoaded"===t.data.eventType){if(window.removeEventListener("message",s),!b)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(b,c)()}};window.addEventListener("message",s)}this.iframe=b}async onIframeLoadedInitVariables(){return{authCookie:await this.localStorage.getAuthCookie(),clientId:this.clientId,deviceShareStored:await this.localStorage.getDeviceShare(),ecosystemId:this.ecosystem?.id,partnerId:this.ecosystem?.partnerId,walletUserId:await this.localStorage.getWalletUserId()}}onIframeLoadHandler(t,o){return async()=>{const n=new MessageChannel,l=new Promise(((l,c)=>{n.port1.onmessage=f=>{const{data:h}=f;n.port1.close(),h.success||c(new Error(h.error)),s.set(t.src,!0),o&&o(),l(!0)}}));t?.contentWindow?.postMessage({data:await this.onIframeLoadedInitVariables(),eventType:"initIframe"},this.iframeBaseUrl,[n.port2]),await l}}async call({procedureName:o,params:n,showIframe:l=!1}){if(!this.iframe)throw new Error("Iframe not found. You are likely calling this from the backend where the DOM is not available.");for(;!s.get(this.iframe.src);)await(0,t.sleep)(1e3*this.POLLING_INTERVAL_SECONDS);l&&(this.iframe.style.display="block",await(0,t.sleep)(5));const c=new MessageChannel,f=new Promise(((o,s)=>{c.port1.onmessage=async n=>{const{data:f}=n;c.port1.close(),l&&(await(0,t.sleep)(100),this.iframe&&(this.iframe.style.display="none")),f.success?o(f.data):s(new Error(f.error))}}));return this.iframe.contentWindow?.postMessage({data:{...n,...await this.onIframeLoadedInitVariables()},eventType:o},this.iframeBaseUrl,[c.port2]),f}destroy(){this.iframe&&s.delete(this.iframe.src)}}}),4161,[2765]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.Auth=void 0;var t=r(d[0]),n=r(d[1]),o=r(d[2]);e.Auth=class{constructor({client:t,querier:n,onAuthSuccess:s,ecosystem:l,baseUrl:h,localStorage:u}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=l,this.AuthQuerier=n,this.localStorage=u,this.onAuthSuccess=s,this.BaseLogin=new o.BaseLogin({baseUrl:h,client:t,ecosystem:l,postLogin:async t=>this.postLogin(t),preLogin:async()=>{await this.preLogin()},querier:n})}async preLogin(){await this.logout()}async postLogin({storedToken:t,walletDetails:n}){t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:n})}async loginWithAuthToken(o,s){"Backend"!==o.storedToken.authProvider&&await this.preLogin();const l=await(0,n.getUserStatus)({authToken:o.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!l)throw new Error("Cannot login, no user found for auth token");if(l.wallets.length>0&&"enclave"===l.wallets[0]?.type)return this.postLogin({storedToken:o.storedToken,walletDetails:{walletAddress:l.wallets[0].address}});if(0===l.wallets.length){const n=await(0,t.generateWallet)({authToken:o.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:o.storedToken,walletDetails:{walletAddress:n.address}})}const h=await this.AuthQuerier.call({params:{recoveryCode:s,storedToken:o.storedToken},procedureName:"loginWithStoredTokenDetails"});return this.postLogin(h)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(t){return this.BaseLogin.loginWithIframe(t)}async authenticateWithIframe(t){return this.BaseLogin.authenticateWithIframe(t)}async loginWithCustomJwt(t){return this.BaseLogin.loginWithCustomJwt(t)}async authenticateWithCustomJwt(t){return this.BaseLogin.authenticateWithCustomJwt(t)}async loginWithCustomAuthEndpoint(t){return this.BaseLogin.loginWithCustomAuthEndpoint(t)}async authenticateWithCustomAuthEndpoint(t){return this.BaseLogin.authenticateWithCustomAuthEndpoint(t)}async sendEmailLoginOtp({email:t}){return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp({phoneNumber:t}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async loginWithEmailOtp(t){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(t)}async authenticateWithEmailOtp(t){return this.BaseLogin.authenticateWithEmailOtp(t)}async loginWithSmsOtp(t){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(t)}async authenticateWithSmsOtp(t){return this.BaseLogin.authenticateWithSmsOtp(t)}async logout(){const t=await this.localStorage.removeAuthCookie(),n=await this.localStorage.removeWalletUserId();return{success:t||n}}}}),4162,[4163,4142,4164]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.generateWallet=async function({client:l,ecosystem:o,authToken:s}){const c=(0,n.getClientFetch)(l,o),w=await c(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/generate`,{headers:{Authorization:`Bearer embedded-wallet-token:${s}`,"Content-Type":"application/json","x-thirdweb-client-id":l.clientId},method:"POST"});if(!w.ok)throw new Error(`Failed to generate wallet - ${w.status} ${w.statusText}`);const{wallet:u}=await w.json();return u};var t=r(d[0]),n=r(d[1])}),4163,[1128,1129]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.BaseLogin=void 0;var t=r(d[0]);class o extends t.AbstractLogin{async authenticateWithModal(){return this.LoginQuerier.call({params:void 0,procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithModal(){await this.preLogin();const t=await this.authenticateWithModal();return this.postLogin(t)}async authenticateWithIframe({email:t}){return this.LoginQuerier.call({params:{email:t},procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithIframe({email:t}){await this.preLogin();const o=await this.authenticateWithIframe({email:t});return this.postLogin(o)}async authenticateWithCustomJwt({encryptionKey:t,jwt:o}){if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({params:{encryptionKey:t,jwt:o},procedureName:"loginWithCustomJwt"})}async loginWithCustomJwt({encryptionKey:t,jwt:o}){if(!t||0===t.length)throw new Error("Encryption key is required for custom jwt auth");await this.preLogin();const n=await this.authenticateWithCustomJwt({encryptionKey:t,jwt:o});return this.postLogin(n)}async authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:o}){return this.LoginQuerier.call({params:{encryptionKey:t,payload:o},procedureName:"loginWithCustomAuthEndpoint"})}async loginWithCustomAuthEndpoint({encryptionKey:t,payload:o}){if(!t||0===t.length)throw new Error("Encryption key is required for custom auth");await this.preLogin();const n=await this.authenticateWithCustomAuthEndpoint({encryptionKey:t,payload:o});return this.postLogin(n)}async authenticateWithEmailOtp({email:t,otp:o,recoveryCode:n}){return this.LoginQuerier.call({params:{email:t,otp:o,recoveryCode:n},procedureName:"verifyThirdwebEmailLoginOtp"})}async loginWithEmailOtp({email:t,otp:o,recoveryCode:n}){const h=await this.authenticateWithEmailOtp({email:t,otp:o,recoveryCode:n});return this.postLogin(h)}async authenticateWithSmsOtp({phoneNumber:t,otp:o,recoveryCode:n}){return this.LoginQuerier.call({params:{otp:o,phoneNumber:t,recoveryCode:n},procedureName:"verifyThirdwebSmsLoginOtp"})}async loginWithSmsOtp({phoneNumber:t,otp:o,recoveryCode:n}){const h=await this.authenticateWithSmsOtp({otp:o,phoneNumber:t,recoveryCode:n});return this.postLogin(h)}}e.BaseLogin=o}),4164,[4165]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractLogin=void 0;e.AbstractLogin=class{constructor({baseUrl:t,querier:n,preLogin:o,postLogin:s,client:l,ecosystem:b}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=t,this.LoginQuerier=n,this.preLogin=o,this.postLogin=s,this.client=l,this.ecosystem=b}async sendEmailLoginOtp({email:t}){return await this.LoginQuerier.call({params:{email:t},procedureName:"sendThirdwebEmailLoginOtp"})}async sendSmsLoginOtp({phoneNumber:t}){return await this.LoginQuerier.call({params:{phoneNumber:t},procedureName:"sendThirdwebSmsLoginOtp"})}}}),4165,[]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.verifyOtp=e.sendOtp=void 0;var t=r(d[0]),n=r(d[1]);e.sendOtp=async o=>{const{client:s,ecosystem:c}=o,l=(0,n.getLoginUrl)({authOption:o.strategy,client:s,ecosystem:c}),p={"Content-Type":"application/json","x-client-id":s.clientId};c?.id&&(p["x-ecosystem-id"]=c.id),c?.partnerId&&(p["x-ecosystem-partner-id"]=c.partnerId);const y=(()=>{switch(o.strategy){case"email":return{email:o.email};case"phone":return{phone:o.phoneNumber}}})(),h=await fetch(l,{body:(0,t.stringify)(y),headers:p,method:"POST"});if(!h.ok)throw new Error("Failed to send verification code");return await h.json()};e.verifyOtp=async o=>{const{client:s,ecosystem:c}=o,l=(0,n.getLoginCallbackUrl)({authOption:o.strategy,client:o.client,ecosystem:o.ecosystem}),p={"Content-Type":"application/json","x-client-id":s.clientId};c?.id&&(p["x-ecosystem-id"]=c.id),c?.partnerId&&(p["x-ecosystem-partner-id"]=c.partnerId);const y=(()=>{switch(o.strategy){case"email":return{code:o.verificationCode,email:o.email};case"phone":return{code:o.verificationCode,phone:o.phoneNumber}}})(),h=await fetch(l,{body:(0,t.stringify)(y),headers:p,method:"POST"});if(!h.ok)throw new Error("Failed to verify verification code");return await h.json()}}),4168,[1136,4147]);
__d((function(g,r,i,a,m,e,d){Object.defineProperty(e,"__esModule",{value:!0}),e.IFrameWallet=void 0;var t=r(d[0]),s=r(d[1]),n=r(d[2]),c=r(d[3]),o=r(d[4]),l=r(d[5]),u=r(d[6]),h=r(d[7]);e.IFrameWallet=class{constructor({client:t,ecosystem:s,querier:n,localStorage:c}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.ecosystem=s,this.walletManagerQuerier=n,this.localStorage=c}async postWalletSetUp(t){t.deviceShareStored&&await this.localStorage.saveDeviceShare(t.deviceShareStored,t.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){const t=await this.walletManagerQuerier.call({params:void 0,procedureName:"getUserStatus"});return"Logged In, Wallet Initialized"===t.status?{status:"Logged In, Wallet Initialized",...t.user,account:await this.getAccount()}:"Logged In, New Device"===t.status?{status:"Logged In, New Device",...t.user}:"Logged In, Wallet Uninitialized"===t.status?{status:"Logged In, Wallet Uninitialized",...t.user}:{status:t.status}}async getAccount(){const p=this.walletManagerQuerier,y=this.client,I=this.ecosystem?.partnerId,{address:v}=await p.call({params:void 0,procedureName:"getAddress"}),w=async t=>{const s={chainId:t.chainId,data:t.data,gasLimit:t.gas,nonce:t.nonce,to:t.to??void 0,value:t.value};t.maxFeePerGas?(s.accessList=t.accessList,s.maxFeePerGas=t.maxFeePerGas,s.maxPriorityFeePerGas=t.maxPriorityFeePerGas,s.type=2):(s.gasPrice=t.gasPrice,s.type=0);const n=(0,l.getThirdwebDomains)().rpc,{signedTransaction:c}=await p.call({params:{chainId:t.chainId,partnerId:I,rpcEndpoint:`https://${t.chainId}.${n}`,transaction:s},procedureName:"signTransaction"});return c};return{address:(0,o.getAddress)(v),async sendTransaction(o){const l=(0,c.getRpcClient)({chain:(0,s.getCachedChain)(o.chainId),client:y}),u=await w(o),h=await(0,n.eth_sendRawTransaction)(l,u);return(0,t.trackTransaction)({chainId:o.chainId,client:y,contractAddress:o.to??void 0,gasPrice:o.gasPrice,transactionHash:h,walletAddress:v,walletType:"inApp"}),{transactionHash:h}},async signMessage({message:t}){const s="string"==typeof t?t:t.raw instanceof Uint8Array?t.raw:(0,u.hexToString)(t.raw),{signedMessage:n}=await p.call({params:{chainId:1,message:s,partnerId:I},procedureName:"signMessage"});return n},async signTransaction(t){if(!t.chainId)throw new Error("chainId required in tx to sign");return w({...t,chainId:t.chainId})},async signTypedData(t){const s=(0,h.parseTypedData)(t);s.types?.EIP712Domain&&(s.types.EIP712Domain=void 0);const n=s.domain,c=n?.chainId,o={...n?.verifyingContract?{verifyingContract:n?.verifyingContract}:{},name:n?.name,version:n?.version};c&&(o.chainId=c);const u=(0,l.getThirdwebDomains)().rpc,{signedTypedData:y}=await p.call({params:{chainId:Number.parseInt(BigInt(c||1).toString()),domain:o,message:s.message,partnerId:I,rpcEndpoint:`https://${c}.${u}`,types:s.types},procedureName:"signTypedDataV4"});return y}}}}}),4169,[1679,1127,2457,1668,1210,1128,1231,4054]);